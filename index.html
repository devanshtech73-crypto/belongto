<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fullscreen Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="referrer" content="no-referrer">

<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;background:#000;overflow:hidden}

/* iframe */
iframe{
  position:fixed;
  inset:0;
  width:100vw;
  height:100vh;
  border:none;
  background:#000;
}

/* alert overlay */
#alertOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  color:#fff;
  display:none;
  align-items:center;
  justify-content:center;
  z-index:10001;
  text-align:center;
  font-family:Arial,sans-serif;
}
#alertOverlay button{
  margin-top:15px;
  padding:8px 18px;
  border:none;
  border-radius:4px;
}

/* leaderboard */
#leaderboard{
  position:fixed;
  right:10px;
  top:10px;
  background:rgba(0,0,0,.7);
  color:#fff;
  font-size:12px;
  padding:8px;
  z-index:9999;
}
</style>
</head>

<body>

<!-- ALERT OVERLAY -->
<div id="alertOverlay">
  <div>
    <h3>Connection Issue</h3>
    <p id="alertMsg"></p>
    <button onclick="document.getElementById('alertOverlay').style.display='none'">
      Close
    </button>
  </div>
</div>

<!-- LEADERBOARD -->
<div id="leaderboard">Loading leaderboardâ€¦</div>

<!-- IFRAME (UNCHANGED LINK) -->
<iframe id="player"
  src="https://pw.rolexcoderz.live/project-45/"
  allow="encrypted-media; autoplay; fullscreen"
  allowfullscreen>
</iframe>

<script>
const API = "https://bcknd.xo.je/index.php";
const alertBox = document.getElementById("alertOverlay");
const alertMsg = document.getElementById("alertMsg");
const leaderboard = document.getElementById("leaderboard");

/* ---------- ALERT ---------- */
function showAlert(msg){
  alertMsg.innerText = msg;
  alertBox.style.display = "flex";
}

/* ---------- XP HEARTBEAT ---------- */
function pingXP(){
  fetch(API + "?action=ping").catch(()=>{
    showAlert("XP service is not responding.");
  });
}
pingXP();
setInterval(pingXP, 60000); // 2 XP per minute

/* ---------- LEADERBOARD ---------- */
function loadLeaderboard(){
  const ctrl = new AbortController();
  setTimeout(()=>ctrl.abort(),8000);

  fetch(API + "?action=leaderboard", { signal: ctrl.signal })
    .then(r => r.ok ? r.json() : Promise.reject())
    .then(data => {
      leaderboard.innerHTML = "<b>Leaderboard</b><br>";
      if(!data.length){
        leaderboard.innerHTML += "No data";
        return;
      }
      data.forEach((u,i)=>{
        leaderboard.innerHTML += `#${i+1} XP: ${u.xp}<br>`;
      });
    })
    .catch(()=>{
      leaderboard.innerText = "Leaderboard unavailable";
      showAlert("Leaderboard service is unavailable.");
    });
}

loadLeaderboard();
setInterval(loadLeaderboard, 10000);
</script>

</body>
</html>
