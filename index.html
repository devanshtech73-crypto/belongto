<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Top-Down Driving Game</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            touch-action: none;
            background-color: #333;
        }
        canvas {
            display: block;
            background-color: #8FBC8F;
            border: 1px solid #000;
        }
        .controls {
            position: absolute;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        .control-btn {
            width: 70px;
            height: 70px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border: 2px solid #FFF;
            color: #FFF;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
            touch-action: manipulation;
        }
        .hud {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #FFF;
            font-family: Arial, sans-serif;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div class="controls">
        <div class="control-btn" id="leftBtn">◀</div>
        <div class="control-btn" id="gasBtn">▲</div>
        <div class="control-btn" id="brakeBtn">▼</div>
        <div class="control-btn" id="rightBtn">▶</div>
    </div>
    <div class="hud">
        <div>Speed: <span id="speed">0</span> km/h</div>
        <div>Distance: <span id="distance">0</span> m</div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Resize canvas
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight * 0.9;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // InputHandler class
        class InputHandler {
            constructor() {
                this.keys = {};
                this.touch = { left: false, right: false, gas: false, brake: false };
                window.addEventListener('keydown', (e) => this.keys[e.key] = true);
                window.addEventListener('keyup', (e) => this.keys[e.key] = false);
                ['leftBtn', 'rightBtn', 'gasBtn', 'brakeBtn'].forEach(id => {
                    const btn = document.getElementById(id);
                    btn.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        this.touch[id.replace('Btn', '')] = true;
                    });
                    btn.addEventListener('touchend', () => this.touch[id.replace('Btn', '')] = false);
                });
            }
            getSteering() {
                if (this.keys['a'] || this.touch.left) return -1;
                if (this.keys['d'] || this.touch.right) return 1;
                return 0;
            }
            getAcceleration() {
                if (this.keys['w'] || this.touch.gas) return 1;
                if (this.keys['s'] || this.touch.brake) return -1;
                return 0;
            }
        }

        // Car class
        class Car {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.angle = 0;
                this.speed = 0;
                this.maxSpeed = 0.15;
                this.acceleration = 0.001;
                this.brake = 0.003;
                this.friction = 0.99;
                this.steering = 0;
                this.steeringFactor = 0.05;
                this.driftFactor = 0.995;
                this.distance = 0;
            }
            update(input) {
                // Acceleration
                this.speed += input.getAcceleration() * this.acceleration;
                this.speed -= input.getAcceleration() * this.brake;
                // Limit speed
                this.speed = Math.max(-this.maxSpeed, Math.min(this.maxSpeed, this.speed));
                // Apply friction
                this.speed *= this.friction;
                // Steering
                this.steering = input.getSteering();
                if (Math.abs(this.speed) > 0.01) {
                    this.angle += this.steering * this.steeringFactor * this.speed;
                    this.angle %= 2 * Math.PI;
                } else {
                    this.angle += this.steering * this.steeringFactor;
                }
                // Movement
                this.x += Math.cos(this.angle) * this.speed;
                this.y += Math.sin(this.angle) * this.speed;
                // Drift effect
                if (Math.abs(this.speed) > 0.05 && Math.abs(this.steering) > 0) {
                    this.speed *= this.driftFactor;
                }
                // Track distance
                this.distance += Math.abs(this.speed) * 100;
            }
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.angle);
                // Draw shadow
                ctx.fillStyle = 'rgba(0, 0, 0, 0.4)';
                ctx.fillRect(-12, -8, 24, 16);
                // Draw car
                ctx.fillStyle = '#336699';
                ctx.fillRect(-10, -6, 20, 12);
                ctx.restore();
            }
        }

        // Track class
        class Track {
            constructor() {
                this.boundaries = [
                    { x: 50, y: 50, w: 800, h: 40 },
                    { x: 850, y: 50, w: 40, h: 600 },
                    { x: 50, y: 650, w: 800, h: 40 },
                    { x: 50, y: 50, w: 40, h: 600 }
                ];
                this.obstacles = [
                    { x: 200, y: 200, w: 20, h: 20 },
                    { x: 400, y: 300, w: 20, h: 20 },
                    { x: 600, y: 400, w: 20, h: 20 }
                ];
            }
            draw() {
                // Draw road
                ctx.fillStyle = '#666';
                ctx.fillRect(50, 50, 800, 600);
                // Draw boundaries
                this.boundaries.forEach(boundary => {
                    ctx.fillStyle = '#333';
                    ctx.fillRect(boundary.x, boundary.y, boundary.w, boundary.h);
                });
                // Draw obstacles
                this.obstacles.forEach(obstacle => {
                    ctx.fillStyle = '#A00';
                    ctx.fillRect(obstacle.x, obstacle.y, obstacle.w, obstacle.h);
                });
            }
            checkCollision(car) {
                for (let boundary of this.boundaries) {
                    if (car.x + 10 > boundary.x && car.x - 10 < boundary.x + boundary.w &&
                        car.y + 6 > boundary.y && car.y - 6 < boundary.y + boundary.h) {
                        return true;
                    }
                }
                for (let obstacle of this.obstacles) {
                    if (car.x + 10 > obstacle.x && car.x - 10 < obstacle.x + obstacle.w &&
                        car.y + 6 > obstacle.y && car.y - 6 < obstacle.y + obstacle.h) {
                        return true;
                    }
                }
                return false;
            }
        }

        // Game initialization
        const input = new InputHandler();
        const car = new Car(100, 100);
        const track = new Track();

        // Game loop
        function gameLoop() {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // Update car
            car.update(input);
            // Check collision
            if (track.checkCollision(car)) {
                car.speed *= 0.8; // Slow down on collision
            }
            // Draw track and car
            track.draw();
            car.draw();
            // Update HUD
            document.getElementById('speed').textContent = Math.round(Math.abs(car.speed) * 1000);
            document.getElementById('distance').textContent = Math.round(car.distance);
            // Loop
            requestAnimationFrame(gameLoop);
        }
        gameLoop();
    </script>
</body>
</html>
