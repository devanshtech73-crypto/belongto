<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Canvas Car Game</title>
<style>
  body { margin:0; overflow:hidden; background:#111; }
  canvas { display:block; }
</style>
</head>
<body>
<canvas id="game"></canvas>
<script>
const c = document.getElementById('game');
const ctx = c.getContext('2d');
resize(); window.onresize=resize;
function resize(){ c.width=innerWidth; c.height=innerHeight; }

let player = { x:c.width/2, y:c.height-150, w:40, h:80, angle:0, speed:0, max:10, acc:0.2, brake:0.3, turn:0.04 };
let wheelAngle=0;
let keys={};
let traffic=[];

for(let i=0;i<8;i++) spawnTraffic();
function spawnTraffic(){
  traffic.push({ x:c.width/2-100+Math.random()*200, y:-Math.random()*1500, w:40, h:80, speed:4+Math.random()*2 });
}

window.addEventListener('keydown',e=>keys[e.key]=1);
window.addEventListener('keyup',e=>keys[e.key]=0);
window.addEventListener('touchstart',()=>keys['ArrowUp']=1);
window.addEventListener('touchend',()=>keys['ArrowUp']=0);

function drawCar(obj,color){
  ctx.save();
  ctx.translate(obj.x,obj.y);
  ctx.rotate(obj.angle);
  ctx.fillStyle=color;
  ctx.fillRect(-obj.w/2,-obj.h/2,obj.w,obj.h);
  ctx.restore();
}

function loop(){
  ctx.clearRect(0,0,c.width,c.height);

  ctx.fillStyle='#333';
  ctx.fillRect(c.width/2-150,0,300,c.height);

  ctx.setLineDash([40,40]);
  ctx.strokeStyle='#fff';
  ctx.lineWidth=6;
  ctx.beginPath();
  ctx.moveTo(c.width/2,0);
  ctx.lineTo(c.width/2,c.height);
  ctx.stroke();
  ctx.setLineDash([]);

  if(keys['ArrowUp']) player.speed = Math.min(player.speed+player.acc, player.max);
  if(keys['ArrowDown']) player.speed = Math.max(player.speed-player.brake, -2);
  if(!keys['ArrowUp']&&!keys['ArrowDown']) player.speed*=0.98;
  if(keys['ArrowLeft']) player.angle -= player.turn*(player.speed/6);
  if(keys['ArrowRight']) player.angle += player.turn*(player.speed/6);

  player.x += Math.sin(player.angle)*player.speed;
  player.y -= Math.cos(player.angle)*player.speed;

  if(player.x< c.width/2-140) player.x=c.width/2-140;
  if(player.x> c.width/2+140) player.x=c.width/2+140;

  traffic.forEach(t=>{
    t.y += t.speed;
    if(t.y>c.height+200){ t.y=-300; t.x=c.width/2-100+Math.random()*200; }
    drawCar(t,'#ff4444');

    if(Math.abs(player.x-t.x)<40 && Math.abs(player.y-t.y)<80){ /* crash removed for mobile friendliness */ player.speed = 0; player.x = c.width/2; player.y = c.height-150; player.angle = 0;(); }
  });

  ctx.globalAlpha=0.3;
  drawCar({x:player.x+10,y:player.y+20,w:50,h:90,angle:player.angle},'#000');
  ctx.globalAlpha=1;

  drawCar(player,'#00ccff');

  requestAnimationFrame(loop);
}
loop();
</script>
<canvas id="steer" width="180" height="180" style="position:fixed; bottom:20px; left:20px; touch-action:none;"></canvas>
<canvas id="gas" width="120" height="120" style="position:fixed; bottom:30px; right:20px;"></canvas>
<canvas id="brake" width="120" height="120" style="position:fixed; bottom:170px; right:20px;"></canvas>

<script>
// Steering wheel
const steer=document.getElementById('steer');
const sctx=steer.getContext('2d');
let steeringTouch=false;
let steeringValue=0;
function drawSteer(angle=0){
 sctx.clearRect(0,0,180,180);
 sctx.save(); sctx.translate(90,90); sctx.rotate(angle);
 sctx.lineWidth=16; sctx.strokeStyle='#333';
 sctx.beginPath(); sctx.arc(0,0,70,0,Math.PI*2); sctx.stroke();
 sctx.lineWidth=8; sctx.strokeStyle='#ffcc00';
 sctx.beginPath(); sctx.moveTo(0,-70); sctx.lineTo(0,-40); sctx.stroke();
 sctx.restore();
}
drawSteer();

steer.addEventListener('touchstart',()=>steeringTouch=true);
steer.addEventListener('touchend',()=>{steeringTouch=false; steeringValue=0;});
steer.addEventListener('touchmove',e=>{
 const t=e.touches[0];
 const r=steer.getBoundingClientRect();
 const dx=t.clientX-(r.left+r.width/2);
 steeringValue=Math.max(-1,Math.min(1,dx/60));
});

// Gas + brake buttons
function drawBtn(ctx,color,text){
 ctx.clearRect(0,0,120,120);
 ctx.fillStyle=color;
 ctx.beginPath(); ctx.arc(60,60,55,0,Math.PI*2); ctx.fill();
 ctx.fillStyle='#fff'; ctx.font='22px sans-serif';
 ctx.textAlign='center'; ctx.textBaseline='middle';
 ctx.fillText(text,60,60);
}
const gctx=gas.getContext('2d');
const bctx=brake.getContext('2d');
drawBtn(gctx,'#0a0','GAS');
drawBtn(bctx,'#a00','BRAKE');

gas.ontouchstart=()=>keys['ArrowUp']=1;
gas.ontouchend=()=>keys['ArrowUp']=0;
brake.ontouchstart=()=>keys['ArrowDown']=1;
brake.ontouchend=()=>keys['ArrowDown']=0;

// Integrate steering into physics
const oldLoop = loop;
loop = function(){
  if(steeringTouch){
    player.angle += steeringValue * player.turn * (player.speed/5);
    drawSteer(-steeringValue);
  } else drawSteer(0);
  oldLoop();
};
loop();
</script>
</body>
</html>
