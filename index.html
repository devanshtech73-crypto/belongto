<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Canvas Car Game</title>
<style>
  body { margin:0; overflow:hidden; background:#111; }
  canvas { display:block; }
</style>
</head>
<body>
<canvas id="game"></canvas>
<script>
const c = document.getElementById('game');
const ctx = c.getContext('2d');
resize(); window.onresize=resize;
function resize(){ c.width=innerWidth; c.height=innerHeight; }

let player = { x:c.width/2, y:c.height-150, w:40, h:80, angle:0, speed:0, max:10, acc:0.2, brake:0.3, turn:0.04 };
let wheelAngle=0;
let keys={};
let traffic=[];

for(let i=0;i<8;i++) spawnTraffic();
function spawnTraffic(){
  traffic.push({ x:c.width/2-100+Math.random()*200, y:-Math.random()*1500, w:40, h:80, speed:4+Math.random()*2 });
}

window.addEventListener('keydown',e=>keys[e.key]=1);
window.addEventListener('keyup',e=>keys[e.key]=0);
window.addEventListener('touchstart',()=>keys['ArrowUp']=1);
window.addEventListener('touchend',()=>keys['ArrowUp']=0);

function drawCar(obj,color){
  ctx.save();
  ctx.translate(obj.x,obj.y);
  ctx.rotate(obj.angle);
  ctx.fillStyle=color;
  ctx.fillRect(-obj.w/2,-obj.h/2,obj.w,obj.h);
  ctx.restore();
}

function loop(){
  ctx.clearRect(0,0,c.width,c.height);

  ctx.fillStyle='#333';
  ctx.fillRect(c.width/2-150,0,300,c.height);

  ctx.setLineDash([40,40]);
  ctx.strokeStyle='#fff';
  ctx.lineWidth=6;
  ctx.beginPath();
  ctx.moveTo(c.width/2,0);
  ctx.lineTo(c.width/2,c.height);
  ctx.stroke();
  ctx.setLineDash([]);

  if(keys['ArrowUp']) player.speed = Math.min(player.speed+player.acc, player.max);
  if(keys['ArrowDown']) player.speed = Math.max(player.speed-player.brake, -2);
  if(!keys['ArrowUp']&&!keys['ArrowDown']) player.speed*=0.98;
  if(keys['ArrowLeft']) player.angle -= player.turn*(player.speed/6);
  if(keys['ArrowRight']) player.angle += player.turn*(player.speed/6);

  player.x += Math.sin(player.angle)*player.speed;
  player.y -= Math.cos(player.angle)*player.speed;

  if(player.x< c.width/2-140) player.x=c.width/2-140;
  if(player.x> c.width/2+140) player.x=c.width/2+140;

  traffic.forEach(t=>{
    t.y += t.speed;
    if(t.y>c.height+200){ t.y=-300; t.x=c.width/2-100+Math.random()*200; }
    drawCar(t,'#ff4444');

    if(Math.abs(player.x-t.x)<40 && Math.abs(player.y-t.y)<80){ /* crash removed for mobile friendliness */ player.speed = 0; player.x = c.width/2; player.y = c.height-150; player.angle = 0;(); }
  });

  ctx.globalAlpha=0.3;
  drawCar({x:player.x+10,y:player.y+20,w:50,h:90,angle:player.angle},'#000');
  ctx.globalAlpha=1;

  drawCar(player,'#00ccff');

  requestAnimationFrame(loop);
}
loop();
</script>
<div id="controls" style="position:fixed;bottom:20px;left:0;right:0;display:flex;justify-content:center;gap:40px;pointer-events:auto;">
<div id="leftBtn" style="width:80px;height:80px;border-radius:50%;background:#222;border:3px solid #555;
box-shadow:0 0 10px #000;display:flex;align-items:center;justify-content:center;color:#fff;font-size:30px;user-select:none;">⟲</div>
<div id="rightBtn" style="width:80px;height:80px;border-radius:50%;background:#222;border:3px solid #555;
box-shadow:0 0 10px #000;display:flex;align-items:center;justify-content:center;color:#fff;font-size:30px;user-select:none;">⟳</div>
<div id="gas" style="width:90px;height:90px;border-radius:50%;background:#0a0;border:3px solid #5f5;box-shadow:0 0 10px #000;
color:white;font-size:22px;display:flex;align-items:center;justify-content:center;">GAS</div>
<div id="brake" style="width:90px;height:90px;border-radius:50%;background:#a00;border:3px solid #f55;box-shadow:0 0 10px #000;
color:white;font-size:22px;display:flex;align-items:center;justify-content:center;">BRAKE</div>
</div>
<script>
const leftBtn=document.getElementById('leftBtn');
const rightBtn=document.getElementById('rightBtn');
const gas=document.getElementById('gas');
const brake=document.getElementById('brake');

leftBtn.ontouchstart=()=>keys['ArrowLeft']=1;
leftBtn.ontouchend=()=>keys['ArrowLeft']=0;
rightBtn.ontouchstart=()=>keys['ArrowRight']=1;
rightBtn.ontouchend=()=>keys['ArrowRight']=0;
gas.ontouchstart=()=>keys['ArrowUp']=1;
gas.ontouchend=()=>keys['ArrowUp']=0;
brake.ontouchstart=()=>keys['ArrowDown']=1;
brake.ontouchend=()=>keys['ArrowDown']=0;
</script>
</body>
</html>
