<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>HD Car Game</title>
<style>
  body { margin:0; overflow:hidden; background:#111; }
  canvas { display:block; touch-action:none; }
</style>
</head>
<body>

<canvas id="game"></canvas>

<!-- Steering wheel -->
<canvas id="steer" width="180" height="180"
style="position:fixed; bottom:20px; left:20px;"></canvas>

<script>
/* ---------------- CORE SETUP ---------------- */
const c = document.getElementById('game');
const ctx = c.getContext('2d');
function resize(){ c.width = innerWidth; c.height = innerHeight; }
resize(); onresize = resize;

let speed = 4;            // will increase with score
let score = 0;
let steeringValue = 0;
let steeringTouch = false;

/* ---------------- PLAYER CAR ---------------- */
let player = {
  x: c.width/2,
  y: c.height - 200,
  w: 55,
  h: 110,
  angle: 0
};

/* ----------- TRAFFIC + TRUCKS -------------- */
let traffic = [];
function spawnTraffic(){
  let type = Math.random() < 0.25 ? "truck" : "car";
  let w = type == "truck" ? 70 : 50;
  let h = type == "truck" ? 150 : 100;
  traffic.push({
    x: c.width/2 - 120 + Math.random()*240,
    y: -Math.random()*1500,
    w, h,
    type,
    color: randomColor()
  });
}
for(let i=0;i<10;i++) spawnTraffic();

function randomColor(){
  const colors = ['#ff4444','#22ccff','#ffaa00','#55ff55','#ff22aa'];
  return colors[Math.floor(Math.random()*colors.length)];
}

/* ---------------- DRAW FUNCTIONS ---------------- */
function drawCar(obj){
  ctx.save();
  ctx.translate(obj.x, obj.y);
  ctx.rotate(obj.angle);

  // BODY
  let grad = ctx.createLinearGradient(-obj.w/2, -obj.h/2, obj.w/2, obj.h/2);
  grad.addColorStop(0, "#222");
  grad.addColorStop(1, "#555");
  ctx.fillStyle = grad;
  ctx.roundRect(-obj.w/2, -obj.h/2, obj.w, obj.h, 10);
  ctx.fill();

  // WINDOWS
  ctx.fillStyle = "rgba(180,220,255,0.8)";
  ctx.fillRect(-obj.w/2 + 10, -obj.h/2 + 15, obj.w - 20, 25);
  ctx.fillRect(-obj.w/2 + 10, obj.h/2 - 40, obj.w - 20, 20);

  // WHEELS
  ctx.fillStyle = "#000";
  ctx.fillRect(-obj.w/2 - 5, -obj.h/2 + 10, 10, 30);
  ctx.fillRect(obj.w/2 - 5, -obj.h/2 + 10, 10, 30);
  ctx.fillRect(-obj.w/2 - 5, obj.h/2 - 40, 10, 30);
  ctx.fillRect(obj.w/2 - 5, obj.h/2 - 40, 10, 30);

  ctx.restore();
}

function drawTraffic(obj){
  ctx.save();
  ctx.translate(obj.x, obj.y);

  if(obj.type == "truck"){
    ctx.fillStyle = "#333";
    ctx.fillRect(-obj.w/2, -obj.h/2, obj.w, obj.h * 0.6);
    ctx.fillStyle = obj.color;
    ctx.fillRect(-obj.w/2, obj.h*0.1, obj.w, obj.h*0.9);
  } else {
    ctx.fillStyle = obj.color;
    ctx.roundRect(-obj.w/2, -obj.h/2, obj.w, obj.h, 8);
    ctx.fill();
  }

  ctx.restore();
}

/* ---------------- ROAD ---------------- */
function drawRoad(){
  ctx.fillStyle = "#222";
  ctx.fillRect(c.width/2 - 150, 0, 300, c.height);

  ctx.strokeStyle = "#fff";
  ctx.lineWidth = 6;
  ctx.setLineDash([40,40]);
  ctx.beginPath();
  ctx.moveTo(c.width/2, 0);
  ctx.lineTo(c.width/2, c.height);
  ctx.stroke();
  ctx.setLineDash([]);
}

/* ---------------- GAME LOOP ---------------- */
function loop(){
  ctx.clearRect(0,0,c.width,c.height);

  drawRoad();

  // auto-speed grows with score
  speed = 5 + score*0.003;

  // Steering
  if(steeringTouch){
    player.angle += steeringValue * 0.03 * (speed/4);
  }

  // Move forward
  player.x += Math.sin(player.angle) * speed;
  player.y -= Math.cos(player.angle) * speed;

  // Keep player inside road
  let left = c.width/2 - 140;
  let right = c.width/2 + 140;
  if(player.x < left) player.x = left;
  if(player.x > right) player.x = right;

  // Draw player
  drawCar(player);

  // Traffic update
  for(let t of traffic){
    t.y += speed * 0.9;

    if(t.y > c.height + 200){
      t.x = c.width/2 - 120 + Math.random()*240;
      t.y = -500;
      t.color = randomColor();
      t.type = Math.random() < 0.25 ? "truck" : "car";
      score++;
    }

    drawTraffic(t);

    // Collision
    if(Math.abs(player.x - t.x) < (player.w+t.w)/2 - 10 &&
       Math.abs(player.y - t.y) < (player.h+t.h)/2 - 10){
      player.x = c.width/2;
      player.y = c.height - 200;
      player.angle = 0;
      score = 0;
      speed = 4;
    }
  }

  requestAnimationFrame(loop);
}
loop();

/* ---------------- STEERING WHEEL ---------------- */
const steer = document.getElementById("steer");
const sctx = steer.getContext("2d");

function drawSteer(angle=0){
  sctx.clearRect(0,0,180,180);
  sctx.save();
  sctx.translate(90,90);
  sctx.rotate(angle);

  sctx.lineWidth = 15;
  sctx.strokeStyle = "#333";
  sctx.beginPath();
  sctx.arc(0,0,70,0,Math.PI*2);
  sctx.stroke();

  sctx.lineWidth = 8;
  sctx.strokeStyle = "#ffcc00";
  sctx.beginPath();
  sctx.moveTo(0,-70);
  sctx.lineTo(0,-40);
  sctx.stroke();

  sctx.restore();
}
drawSteer();

steer.addEventListener("touchstart",()=>{ steeringTouch=true; });
steer.addEventListener("touchend",()=>{ steeringTouch=false; steeringValue=0; drawSteer(0); });
steer.addEventListener("touchmove",e=>{
  const r = steer.getBoundingClientRect();
  const touch = e.touches[0];
  const dx = touch.clientX - (r.left + r.width/2);
  steeringValue = Math.max(-1, Math.min(1, dx/60));
  drawSteer(-steeringValue);
});
</script>
</body>
</html>
