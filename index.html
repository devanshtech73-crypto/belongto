<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Mobile Car Drift Demo</title>

<!-- PIXIJS (Render) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.2.4/pixi.min.js"></script>

<!-- MATTER JS (Physics) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>

<style>
body {
    margin: 0;
    overflow: hidden;
    background: #111;
    touch-action: none;
}

#controls {
    position: fixed;
    bottom: 0;
    width: 100%;
    height: 35%;
    display: flex;
    justify-content: space-around;
    align-items: center;
    pointer-events: auto;
}

.btn {
    width: 90px;
    height: 90px;
    border-radius: 50%;
    background: rgba(255,255,255,0.1);
    color: white;
    backdrop-filter: blur(6px);
    border: 2px solid rgba(255,255,255,0.2);
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:22px;
    user-select:none;
}
</style>
</head>
<body>

<div id="controls">
    <div class="btn" id="left">‚¨ÖÔ∏è</div>
    <div style="display:flex; flex-direction:column; gap:10px;">
        <div class="btn" id="gas">üöóüí®</div>
        <div class="btn" id="brake">üÖ±Ô∏è</div>
    </div>
    <div class="btn" id="right">‚û°Ô∏è</div>
</div>

<script>
/* ------------------------------------
   BASIC RENDERER
------------------------------------*/
const app = new PIXI.Application({
    width: window.innerWidth,
    height: window.innerHeight,
    background: '#222'
});
document.body.appendChild(app.view);

/* ------------------------------------
   PHYSICS ENGINE
------------------------------------*/
const Engine = Matter.Engine,
      Bodies = Matter.Bodies,
      Body   = Matter.Body,
      World  = Matter.World;

const engine = Engine.create();
engine.world.gravity.y = 0;

/* ------------------------------------
   CAR SPRITE
------------------------------------*/
let carTexture = PIXI.Texture.from(
  "https://i.imgur.com/pxd7r4a.png"  // simple top-down car image
);
const carSprite = new PIXI.Sprite(carTexture);
carSprite.anchor.set(0.5);
carSprite.width = 90;
carSprite.height = 180;
app.stage.addChild(carSprite);

/* ------------------------------------
   CAR BODY
------------------------------------*/
const carBody = Bodies.rectangle(
    window.innerWidth/2,
    window.innerHeight/2,
    50, 100,
    { frictionAir: 0.2, friction: 0.01, restitution: 0.1 }
);
World.add(engine.world, [carBody]);

/* ------------------------------------
   TYRE MARKS
------------------------------------*/
let graphics = new PIXI.Graphics();
app.stage.addChild(graphics);

/* ------------------------------------
   TOUCH CONTROLS
------------------------------------*/
let steer = 0;
let throttle = 0;

function bindBtn(id, downFn, upFn){
    const el = document.getElementById(id);
    el.addEventListener("touchstart", e => { e.preventDefault(); downFn(); });
    el.addEventListener("touchend", e => { e.preventDefault(); upFn(); });
}

bindBtn("left",  ()=> steer = -0.04, ()=> steer = 0);
bindBtn("right", ()=> steer =  0.04, ()=> steer = 0);
bindBtn("gas",   ()=> throttle = 0.002, ()=> throttle = 0);
bindBtn("brake", ()=> throttle = -0.002, ()=> throttle = 0);

/* ------------------------------------
   GAME LOOP
------------------------------------*/
app.ticker.add(() => {
    Engine.update(engine, 16.6);

    // Apply forward/back force
    const angle = carBody.angle;
    const force = { x: Math.sin(angle)*throttle, y: -Math.cos(angle)*throttle };
    Body.applyForce(carBody, carBody.position, force);

    // Steering
    Body.setAngularVelocity(carBody, steer);

    // Draw tyre marks
    graphics.lineStyle(2, 0x000000, 0.3);
    graphics.moveTo(carSprite.x, carSprite.y);
    graphics.lineTo(
        carSprite.x - Math.sin(angle)*3,
        carSprite.y + Math.cos(angle)*3
    );

    // Sync sprite position
    carSprite.x = carBody.position.x;
    carSprite.y = carBody.position.y;
    carSprite.rotation = angle;
});
</script>
</body>
</html>
